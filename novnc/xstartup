#!/bin/bash

# 환경 변수 설정
export XDG_RUNTIME_DIR="/tmp/xdg-runtime-dir"
mkdir -p "$XDG_RUNTIME_DIR"
chmod 700 "$XDG_RUNTIME_DIR"

export DISPLAY=:1
export LANG=ko_KR.UTF-8
export LANGUAGE=ko_KR:ko
export LC_ALL=ko_KR.UTF-8
export XMODIFIERS=@im=ibus
export GTK_IM_MODULE=ibus
export QT_IM_MODULE=ibus
export QT4_IM_MODULE=ibus

# dbus 시작
if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
  eval $(dbus-launch --sh-syntax)
fi

# ibus 시작
ibus-daemon -drx &

# XFCE 세션 시작 (여러 방법 시도)
if command -v startxfce4 >/dev/null 2>&1; then
  startxfce4 &
elif command -v xfce4-session >/dev/null 2>&1; then
  xfce4-session &
else
  # 수동 XFCE 컴포넌트 시작
  xfwm4 &
  xfce4-panel &
  xfdesktop &
  thunar --daemon &
  xfce4-terminal &
fi

# 세션이 종료되지 않도록 함
tail -f /dev/null 